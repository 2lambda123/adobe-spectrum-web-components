{"version":3,"file":"6eaca00d.js","sources":["../../../packages/theme/src/Theme.js"],"sourcesContent":["import {\n  supportsAdoptingStyleSheets\n} from \"@spectrum-web-components/base\";\nconst ThemeVariantValues = [\"spectrum\", \"express\"];\nconst ScaleValues = [\"medium\", \"large\", \"medium-express\", \"large-express\"];\nconst ColorValues = [\n  \"light\",\n  \"lightest\",\n  \"dark\",\n  \"darkest\",\n  \"light-express\",\n  \"lightest-express\",\n  \"dark-express\",\n  \"darkest-express\"\n];\nconst _Theme = class extends HTMLElement {\n  constructor() {\n    super();\n    this._dir = \"\";\n    this._theme = \"spectrum\";\n    this._color = \"\";\n    this._scale = \"\";\n    this.trackedChildren = /* @__PURE__ */ new Set();\n    this._updateRequested = false;\n    this._contextConsumers = /* @__PURE__ */ new Map();\n    this.attachShadow({ mode: \"open\" });\n    const node = document.importNode(_Theme.template.content, true);\n    this.shadowRoot.appendChild(node);\n    this.shouldAdoptStyles();\n    this.addEventListener(\"sp-query-theme\", this.onQueryTheme);\n    this.addEventListener(\"sp-language-context\", this._handleContextPresence);\n    this.updateComplete = this.__createDeferredPromise();\n  }\n  static get observedAttributes() {\n    return [\"color\", \"scale\", \"theme\", \"lang\", \"dir\"];\n  }\n  set dir(dir) {\n    if (dir === this.dir)\n      return;\n    this.setAttribute(\"dir\", dir);\n    this._dir = dir;\n    const targetDir = dir === \"rtl\" ? dir : \"ltr\";\n    this.trackedChildren.forEach((el) => {\n      el.setAttribute(\"dir\", targetDir);\n    });\n  }\n  get dir() {\n    return this._dir;\n  }\n  attributeChangedCallback(attrName, old, value) {\n    if (old === value) {\n      return;\n    }\n    if (attrName === \"color\") {\n      this.color = value;\n    } else if (attrName === \"scale\") {\n      this.scale = value;\n    } else if (attrName === \"lang\" && !!value) {\n      this.lang = value;\n      this._provideContext();\n    } else if (attrName === \"theme\") {\n      this.theme = value;\n    } else if (attrName === \"dir\") {\n      this.dir = value;\n    }\n  }\n  requestUpdate() {\n    if (window.ShadyCSS !== void 0 && !window.ShadyCSS.nativeShadow) {\n      window.ShadyCSS.styleElement(this);\n    } else {\n      this.shouldAdoptStyles();\n    }\n  }\n  get theme() {\n    const themeFragments = _Theme.themeFragmentsByKind.get(\"theme\");\n    const { name } = themeFragments && themeFragments.get(\"default\") || {};\n    return this._theme || name || \"\";\n  }\n  set theme(newValue) {\n    if (newValue === this._theme)\n      return;\n    const theme = !!newValue && ThemeVariantValues.includes(newValue) ? newValue : this.theme;\n    if (theme !== this._theme) {\n      this._theme = theme;\n      this.requestUpdate();\n    }\n    if (theme) {\n      this.setAttribute(\"theme\", theme);\n    } else {\n      this.removeAttribute(\"theme\");\n    }\n  }\n  get color() {\n    const themeFragments = _Theme.themeFragmentsByKind.get(\"color\");\n    const { name } = themeFragments && themeFragments.get(\"default\") || {};\n    return this._color || name || \"\";\n  }\n  set color(newValue) {\n    if (newValue === this._color)\n      return;\n    const color = !!newValue && ColorValues.includes(newValue) ? newValue : this.color;\n    if (color !== this._color) {\n      this._color = color;\n      this.requestUpdate();\n    }\n    if (color) {\n      this.setAttribute(\"color\", color);\n    } else {\n      this.removeAttribute(\"color\");\n    }\n  }\n  get scale() {\n    const themeFragments = _Theme.themeFragmentsByKind.get(\"scale\");\n    const { name } = themeFragments && themeFragments.get(\"default\") || {};\n    return this._scale || name || \"\";\n  }\n  set scale(newValue) {\n    if (newValue === this._scale)\n      return;\n    const scale = !!newValue && ScaleValues.includes(newValue) ? newValue : this.scale;\n    if (scale !== this._scale) {\n      this._scale = scale;\n      this.requestUpdate();\n    }\n    if (scale) {\n      this.setAttribute(\"scale\", scale);\n    } else {\n      this.removeAttribute(\"scale\");\n    }\n  }\n  get styles() {\n    const themeKinds = [\n      ..._Theme.themeFragmentsByKind.keys()\n    ];\n    const getStyle = (fragments, name, kind) => {\n      const currentStyles = kind && kind !== \"theme\" && this.theme === \"express\" ? fragments.get(`${name}-express`) : fragments.get(name);\n      const isAppliedFragment = name === \"spectrum\" || !kind || this.hasAttribute(kind);\n      if (currentStyles && isAppliedFragment) {\n        return currentStyles.styles;\n      }\n      return;\n    };\n    const styles = themeKinds.reduce((acc, kind) => {\n      const kindFragments = _Theme.themeFragmentsByKind.get(kind);\n      let style;\n      if (kind === \"app\" || kind === \"core\") {\n        style = getStyle(kindFragments, kind);\n      } else {\n        const { [kind]: name } = this;\n        style = getStyle(kindFragments, name, kind);\n      }\n      if (style) {\n        acc.push(style);\n      }\n      return acc;\n    }, []);\n    if (false) {\n      const issues = [];\n      const checkForAttribute = (name, resolvedValue, actualValue) => {\n        var _a;\n        const themeModifier = this.theme && this.theme !== \"spectrum\" ? `-${this.theme}` : \"\";\n        if (!resolvedValue) {\n          issues.push(`You have not explicitly set the \"${name}\" attribute and there is no default value on which to fallback.`);\n        } else if (!actualValue) {\n          issues.push(`You have not explicitly set the \"${name}\" attribute, the default value (\"${resolvedValue}\") is being used as a fallback.`);\n        } else if (!((_a = _Theme.themeFragmentsByKind.get(name)) == null ? void 0 : _a.get(resolvedValue + themeModifier))) {\n          issues.push(`You have set \"${name}='${resolvedValue}'\" but the associated theme fragment has not been loaded.`);\n        }\n      };\n      checkForAttribute(\"theme\", this.theme, this._theme);\n      checkForAttribute(\"color\", this.color, this._color);\n      checkForAttribute(\"scale\", this.scale, this._scale);\n      if (issues.length) {\n        window.__swc.warn(this, \"You are leveraging an <sp-theme> element and the following issues may disrupt your theme delivery:\", \"https://opensource.adobe.com/spectrum-web-components/components/theme/#example\", {\n          issues\n        });\n      }\n    }\n    return [...styles];\n  }\n  static get template() {\n    if (!this.templateElement) {\n      this.templateElement = document.createElement(\"template\");\n      this.templateElement.innerHTML = \"<slot></slot>\";\n    }\n    return this.templateElement;\n  }\n  __createDeferredPromise() {\n    return new Promise((resolve) => {\n      this.__resolve = resolve;\n    });\n  }\n  onQueryTheme(event) {\n    if (event.defaultPrevented) {\n      return;\n    }\n    event.preventDefault();\n    const { detail: theme } = event;\n    theme.color = this.color || void 0;\n    theme.scale = this.scale || void 0;\n    theme.lang = this.lang || document.documentElement.lang || navigator.language;\n    theme.theme = this.theme || void 0;\n  }\n  connectedCallback() {\n    this.shouldAdoptStyles();\n    if (window.ShadyCSS !== void 0) {\n      window.ShadyCSS.styleElement(this);\n    }\n    _Theme.instances.add(this);\n    if (!this.hasAttribute(\"dir\")) {\n      let dirParent = this.assignedSlot || this.parentNode;\n      while (dirParent !== document.documentElement && !(dirParent instanceof _Theme)) {\n        dirParent = dirParent.assignedSlot || dirParent.parentNode || dirParent.host;\n      }\n      this.dir = dirParent.dir === \"rtl\" ? dirParent.dir : \"ltr\";\n    }\n  }\n  disconnectedCallback() {\n    _Theme.instances.delete(this);\n  }\n  startManagingContentDirection(el) {\n    this.trackedChildren.add(el);\n  }\n  stopManagingContentDirection(el) {\n    this.trackedChildren.delete(el);\n  }\n  async shouldAdoptStyles() {\n    if (!this._updateRequested) {\n      this.updateComplete = this.__createDeferredPromise();\n      this._updateRequested = true;\n      this._updateRequested = await false;\n      this.adoptStyles();\n      this.__resolve(true);\n    }\n  }\n  adoptStyles() {\n    const styles = this.styles;\n    if (window.ShadyCSS !== void 0 && !window.ShadyCSS.nativeShadow && window.ShadyCSS.ScopingShim) {\n      const fragmentCSS = [];\n      for (const [kind, fragments] of _Theme.themeFragmentsByKind) {\n        for (const [name, { styles: styles2 }] of fragments) {\n          if (name === \"default\")\n            continue;\n          let cssText = styles2.cssText;\n          if (!_Theme.defaultFragments.has(name)) {\n            cssText = cssText.replace(\":host\", `:host([${kind}='${name}'])`);\n          }\n          fragmentCSS.push(cssText);\n        }\n      }\n      window.ShadyCSS.ScopingShim.prepareAdoptedCssText(fragmentCSS, this.localName);\n      window.ShadyCSS.prepareTemplate(_Theme.template, this.localName);\n    } else if (supportsAdoptingStyleSheets) {\n      const styleSheets = [];\n      for (const style of styles) {\n        styleSheets.push(style.styleSheet);\n      }\n      this.shadowRoot.adoptedStyleSheets = styleSheets;\n    } else {\n      const styleNodes = this.shadowRoot.querySelectorAll(\"style\");\n      styleNodes.forEach((element) => element.remove());\n      styles.forEach((s) => {\n        const style = document.createElement(\"style\");\n        style.textContent = s.cssText;\n        this.shadowRoot.appendChild(style);\n      });\n    }\n  }\n  static registerThemeFragment(name, kind, styles) {\n    const fragmentMap = _Theme.themeFragmentsByKind.get(kind) || /* @__PURE__ */ new Map();\n    if (fragmentMap.size === 0) {\n      _Theme.themeFragmentsByKind.set(kind, fragmentMap);\n      fragmentMap.set(\"default\", { name, styles });\n      _Theme.defaultFragments.add(name);\n    }\n    fragmentMap.set(name, { name, styles });\n    _Theme.instances.forEach((instance) => instance.shouldAdoptStyles());\n  }\n  _provideContext() {\n    this._contextConsumers.forEach((consume) => consume(this.lang));\n  }\n  _handleContextPresence(event) {\n    const target = event.composedPath()[0];\n    if (this._contextConsumers.has(target)) {\n      this._contextConsumers.delete(target);\n    } else {\n      this._contextConsumers.set(target, event.detail.callback);\n      const callback = this._contextConsumers.get(target);\n      if (callback) {\n        callback(this.lang || document.documentElement.lang || navigator.language);\n      }\n    }\n  }\n};\nexport let Theme = _Theme;\nTheme.themeFragmentsByKind = /* @__PURE__ */ new Map();\nTheme.defaultFragments = /* @__PURE__ */ new Set([\"spectrum\"]);\nTheme.instances = /* @__PURE__ */ new Set();\n//# sourceMappingURL=Theme.js.map\n"],"names":["ScaleValues","ColorValues","HTMLElement","constructor","super","this","Set","_updateRequested","_contextConsumers","Map","attachShadow","mode","document","importNode","_Theme","template","content","shadowRoot","appendChild","node","shouldAdoptStyles","addEventListener","onQueryTheme","_handleContextPresence","updateComplete","__createDeferredPromise","observedAttributes","dir","setAttribute","_dir","trackedChildren","forEach","el","targetDir","attributeChangedCallback","attrName","old","value","color","scale","lang","_provideContext","theme","requestUpdate","window","ShadyCSS","nativeShadow","styleElement","themeFragmentsByKind","get","name","themeFragments","_theme","newValue","ThemeVariantValues","includes","removeAttribute","_color","_scale","styles","keys","getStyle","fragments","kind","hasAttribute","currentStyles","isAppliedFragment","themeKinds","reduce","acc","style","kindFragments","[object Object]","push","templateElement","createElement","innerHTML","Promise","resolve","__resolve","event","defaultPrevented","preventDefault","detail","documentElement","navigator","language","connectedCallback","instances","add","assignedSlot","parentNode","dirParent","host","disconnectedCallback","delete","startManagingContentDirection","stopManagingContentDirection","adoptStyles","ScopingShim","styles2","cssText","defaultFragments","has","replace","fragmentCSS","prepareAdoptedCssText","localName","prepareTemplate","supportsAdoptingStyleSheets","styleSheets","styleSheet","adoptedStyleSheets","querySelectorAll","element","remove","s","textContent","fragmentMap","size","set","instance","consume","composedPath","target","callback","Theme"],"mappings":"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"}
{"version":3,"file":"53b87a92.js","sources":["../../../tools/reactive-controllers/src/FocusGroup.js","../../../tools/reactive-controllers/src/RovingTabindex.js"],"sourcesContent":["export class FocusGroupController {\n  constructor(host, {\n    direction,\n    elementEnterAction,\n    elements,\n    focusInIndex,\n    isFocusableElement,\n    listenerScope\n  } = { elements: () => [] }) {\n    this._currentIndex = -1;\n    this._direction = () => \"both\";\n    this.directionLength = 5;\n    this.elementEnterAction = (_el) => {\n      return;\n    };\n    this._focused = false;\n    this._focusInIndex = (_elements) => 0;\n    this.isFocusableElement = (_el) => true;\n    this._listenerScope = () => this.host;\n    this.offset = 0;\n    this.handleFocusin = (event) => {\n      if (!this.isEventWithinListenerScope(event))\n        return;\n      if (this.isRelatedTargetAnElement(event)) {\n        this.hostContainsFocus();\n      }\n      const path = event.composedPath();\n      let targetIndex = -1;\n      path.find((el) => {\n        targetIndex = this.elements.indexOf(el);\n        return targetIndex !== -1;\n      });\n      this.currentIndex = targetIndex > -1 ? targetIndex : this.currentIndex;\n    };\n    this.handleFocusout = (event) => {\n      if (this.isRelatedTargetAnElement(event)) {\n        this.hostNoLongerContainsFocus();\n      }\n    };\n    this.handleKeydown = (event) => {\n      if (!this.acceptsEventCode(event.code) || event.defaultPrevented) {\n        return;\n      }\n      let diff = 0;\n      switch (event.code) {\n        case \"ArrowRight\":\n          diff += 1;\n          break;\n        case \"ArrowDown\":\n          diff += this.direction === \"grid\" ? this.directionLength : 1;\n          break;\n        case \"ArrowLeft\":\n          diff -= 1;\n          break;\n        case \"ArrowUp\":\n          diff -= this.direction === \"grid\" ? this.directionLength : 1;\n          break;\n        case \"End\":\n          this.currentIndex = 0;\n          diff -= 1;\n          break;\n        case \"Home\":\n          this.currentIndex = this.elements.length - 1;\n          diff += 1;\n          break;\n      }\n      event.preventDefault();\n      if (this.direction === \"grid\" && this.currentIndex + diff < 0) {\n        this.currentIndex = 0;\n      } else if (this.direction === \"grid\" && this.currentIndex + diff > this.elements.length - 1) {\n        this.currentIndex = this.elements.length - 1;\n      } else {\n        this.setCurrentIndexCircularly(diff);\n      }\n      this.elementEnterAction(this.elements[this.currentIndex]);\n      this.focus();\n    };\n    this.host = host;\n    this.host.addController(this);\n    this._elements = elements;\n    this.isFocusableElement = isFocusableElement || this.isFocusableElement;\n    if (typeof direction === \"string\") {\n      this._direction = () => direction;\n    } else if (typeof direction === \"function\") {\n      this._direction = direction;\n    }\n    this.elementEnterAction = elementEnterAction || this.elementEnterAction;\n    if (typeof focusInIndex === \"number\") {\n      this._focusInIndex = () => focusInIndex;\n    } else if (typeof focusInIndex === \"function\") {\n      this._focusInIndex = focusInIndex;\n    }\n    if (typeof listenerScope === \"object\") {\n      this._listenerScope = () => listenerScope;\n    } else if (typeof listenerScope === \"function\") {\n      this._listenerScope = listenerScope;\n    }\n  }\n  get currentIndex() {\n    if (this._currentIndex === -1) {\n      this._currentIndex = this.focusInIndex;\n    }\n    return this._currentIndex - this.offset;\n  }\n  set currentIndex(currentIndex) {\n    this._currentIndex = currentIndex + this.offset;\n  }\n  get direction() {\n    return this._direction();\n  }\n  get elements() {\n    if (!this.cachedElements) {\n      this.cachedElements = this._elements();\n    }\n    return this.cachedElements;\n  }\n  set focused(focused) {\n    if (focused === this.focused)\n      return;\n    this._focused = focused;\n  }\n  get focused() {\n    return this._focused;\n  }\n  get focusInElement() {\n    return this.elements[this.focusInIndex];\n  }\n  get focusInIndex() {\n    return this._focusInIndex(this.elements);\n  }\n  isEventWithinListenerScope(event) {\n    if (this._listenerScope() === this.host)\n      return true;\n    return event.composedPath().includes(this._listenerScope());\n  }\n  update({ elements } = { elements: () => [] }) {\n    this.unmanage();\n    this._elements = elements;\n    this.clearElementCache();\n    this.manage();\n  }\n  focus(options) {\n    let focusElement = this.elements[this.currentIndex];\n    if (!focusElement || !this.isFocusableElement(focusElement)) {\n      this.setCurrentIndexCircularly(1);\n      focusElement = this.elements[this.currentIndex];\n    }\n    if (focusElement && this.isFocusableElement(focusElement)) {\n      focusElement.focus(options);\n    }\n  }\n  clearElementCache(offset = 0) {\n    delete this.cachedElements;\n    this.offset = offset;\n  }\n  setCurrentIndexCircularly(diff) {\n    const { length } = this.elements;\n    let steps = length;\n    let nextIndex = (length + this.currentIndex + diff) % length;\n    while (steps && this.elements[nextIndex] && !this.isFocusableElement(this.elements[nextIndex])) {\n      nextIndex = (length + nextIndex + diff) % length;\n      steps -= 1;\n    }\n    this.currentIndex = nextIndex;\n  }\n  hostContainsFocus() {\n    this.host.addEventListener(\"focusout\", this.handleFocusout);\n    this.host.addEventListener(\"keydown\", this.handleKeydown);\n    this.focused = true;\n  }\n  hostNoLongerContainsFocus() {\n    this.host.addEventListener(\"focusin\", this.handleFocusin);\n    this.host.removeEventListener(\"focusout\", this.handleFocusout);\n    this.host.removeEventListener(\"keydown\", this.handleKeydown);\n    this.currentIndex = this.focusInIndex;\n    this.focused = false;\n  }\n  isRelatedTargetAnElement(event) {\n    const relatedTarget = event.relatedTarget;\n    return !this.elements.includes(relatedTarget);\n  }\n  acceptsEventCode(code) {\n    if (code === \"End\" || code === \"Home\") {\n      return true;\n    }\n    switch (this.direction) {\n      case \"horizontal\":\n        return code === \"ArrowLeft\" || code === \"ArrowRight\";\n      case \"vertical\":\n        return code === \"ArrowUp\" || code === \"ArrowDown\";\n      case \"both\":\n      case \"grid\":\n        return code.startsWith(\"Arrow\");\n    }\n  }\n  manage() {\n    this.addEventListeners();\n  }\n  unmanage() {\n    this.removeEventListeners();\n  }\n  addEventListeners() {\n    this.host.addEventListener(\"focusin\", this.handleFocusin);\n  }\n  removeEventListeners() {\n    this.host.removeEventListener(\"focusin\", this.handleFocusin);\n    this.host.removeEventListener(\"focusout\", this.handleFocusout);\n    this.host.removeEventListener(\"keydown\", this.handleKeydown);\n  }\n  hostConnected() {\n    this.addEventListeners();\n  }\n  hostDisconnected() {\n    this.removeEventListeners();\n  }\n}\n//# sourceMappingURL=FocusGroup.js.map\n","import { FocusGroupController } from \"./FocusGroup.js\";\nexport class RovingTabindexController extends FocusGroupController {\n  constructor() {\n    super(...arguments);\n    this.managed = true;\n    this.manageIndexesAnimationFrame = 0;\n  }\n  set focused(focused) {\n    if (focused === this.focused)\n      return;\n    super.focused = focused;\n    this.manageTabindexes();\n  }\n  get focused() {\n    return super.focused;\n  }\n  clearElementCache(offset = 0) {\n    cancelAnimationFrame(this.manageIndexesAnimationFrame);\n    super.clearElementCache(offset);\n    if (!this.managed)\n      return;\n    this.manageIndexesAnimationFrame = requestAnimationFrame(() => this.manageTabindexes());\n  }\n  manageTabindexes() {\n    if (this.focused) {\n      this.updateTabindexes(() => ({ tabIndex: -1 }));\n    } else {\n      this.updateTabindexes((el) => {\n        return {\n          removeTabIndex: el.contains(this.focusInElement) && el !== this.focusInElement,\n          tabIndex: el === this.focusInElement ? 0 : -1\n        };\n      });\n    }\n  }\n  updateTabindexes(getTabIndex) {\n    this.elements.forEach((el) => {\n      const { tabIndex, removeTabIndex } = getTabIndex(el);\n      if (!removeTabIndex) {\n        el.tabIndex = tabIndex;\n        return;\n      }\n      el.removeAttribute(\"tabindex\");\n      const updatable = el;\n      if (updatable.requestUpdate)\n        updatable.requestUpdate();\n    });\n  }\n  manage() {\n    this.managed = true;\n    this.manageTabindexes();\n    super.manage();\n  }\n  unmanage() {\n    this.managed = false;\n    this.updateTabindexes(() => ({ tabIndex: 0 }));\n    super.unmanage();\n  }\n  hostUpdated() {\n    if (!this.host.hasUpdated) {\n      this.manageTabindexes();\n    }\n  }\n}\n//# sourceMappingURL=RovingTabindex.js.map\n"],"names":["FocusGroupController","constructor","host","direction","elementEnterAction","elements","focusInIndex","isFocusableElement","listenerScope","this","_currentIndex","_direction","directionLength","_el","_elements","_listenerScope","offset","handleFocusin","event","isEventWithinListenerScope","isRelatedTargetAnElement","hostContainsFocus","path","composedPath","targetIndex","find","el","indexOf","currentIndex","hostNoLongerContainsFocus","handleKeydown","acceptsEventCode","code","defaultPrevented","diff","length","preventDefault","setCurrentIndexCircularly","focus","addController","_focusInIndex","cachedElements","focused","_focused","focusInElement","includes","update","unmanage","clearElementCache","manage","options","focusElement","nextIndex","steps","addEventListener","handleFocusout","removeEventListener","relatedTarget","startsWith","addEventListeners","removeEventListeners","hostConnected","hostDisconnected","RovingTabindexController","managed","manageIndexesAnimationFrame","super","manageTabindexes","cancelAnimationFrame","requestAnimationFrame","updateTabindexes","tabIndex","removeTabIndex","contains","getTabIndex","forEach","removeAttribute","updatable","requestUpdate","hostUpdated","hasUpdated"],"mappings":"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"}
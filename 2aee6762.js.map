{"version":3,"file":"2aee6762.js","sources":["../../../tools/reactive-controllers/src/FocusGroup.js","../../../tools/reactive-controllers/src/RovingTabindex.js"],"sourcesContent":["export class FocusGroupController {\n    constructor(host, { direction, elementEnterAction, elements, focusInIndex, isFocusableElement, listenerScope, } = { elements: () => [] }) {\n        this._currentIndex = -1;\n        this._direction = () => 'both';\n        this.directionLength = 5;\n        this.elementEnterAction = (_el) => {\n            return;\n        };\n        this._focused = false;\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        this._focusInIndex = (_elements) => 0;\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        this.isFocusableElement = (_el) => true;\n        this._listenerScope = () => this.host;\n        // When elements are virtualized, the delta between the first element\n        // and the first rendered element.\n        this.offset = 0;\n        this.handleFocusin = (event) => {\n            if (!this.isEventWithinListenerScope(event))\n                return;\n            if (this.isRelatedTargetAnElement(event)) {\n                this.hostContainsFocus();\n            }\n            const path = event.composedPath();\n            let targetIndex = -1;\n            path.find((el) => {\n                targetIndex = this.elements.indexOf(el);\n                return targetIndex !== -1;\n            });\n            this.currentIndex = targetIndex > -1 ? targetIndex : this.currentIndex;\n        };\n        this.handleFocusout = (event) => {\n            if (this.isRelatedTargetAnElement(event)) {\n                this.hostNoLongerContainsFocus();\n            }\n        };\n        this.handleKeydown = (event) => {\n            if (!this.acceptsEventCode(event.code) || event.defaultPrevented) {\n                return;\n            }\n            let diff = 0;\n            switch (event.code) {\n                case 'ArrowRight':\n                    diff += 1;\n                    break;\n                case 'ArrowDown':\n                    diff += this.direction === 'grid' ? this.directionLength : 1;\n                    break;\n                case 'ArrowLeft':\n                    diff -= 1;\n                    break;\n                case 'ArrowUp':\n                    diff -= this.direction === 'grid' ? this.directionLength : 1;\n                    break;\n                case 'End':\n                    this.currentIndex = 0;\n                    diff -= 1;\n                    break;\n                case 'Home':\n                    this.currentIndex = this.elements.length - 1;\n                    diff += 1;\n                    break;\n            }\n            event.preventDefault();\n            if (this.direction === 'grid' && this.currentIndex + diff < 0) {\n                this.currentIndex = 0;\n            }\n            else if (this.direction === 'grid' &&\n                this.currentIndex + diff > this.elements.length - 1) {\n                this.currentIndex = this.elements.length - 1;\n            }\n            else {\n                this.setCurrentIndexCircularly(diff);\n            }\n            // To allow the `focusInIndex` to be calculated with the \"after\" state of the keyboard interaction\n            // do `elementEnterAction` _before_ focusing the next element.\n            this.elementEnterAction(this.elements[this.currentIndex]);\n            this.focus();\n        };\n        this.host = host;\n        this.host.addController(this);\n        this._elements = elements;\n        this.isFocusableElement = isFocusableElement || this.isFocusableElement;\n        // @TODO: abstract a method to simplify the conditional wrapping of the values as functions.\n        if (typeof direction === 'string') {\n            this._direction = () => direction;\n        }\n        else if (typeof direction === 'function') {\n            this._direction = direction;\n        }\n        this.elementEnterAction = elementEnterAction || this.elementEnterAction;\n        if (typeof focusInIndex === 'number') {\n            this._focusInIndex = () => focusInIndex;\n        }\n        else if (typeof focusInIndex === 'function') {\n            this._focusInIndex = focusInIndex;\n        }\n        if (typeof listenerScope === 'object') {\n            this._listenerScope = () => listenerScope;\n        }\n        else if (typeof listenerScope === 'function') {\n            this._listenerScope = listenerScope;\n        }\n    }\n    get currentIndex() {\n        if (this._currentIndex === -1) {\n            this._currentIndex = this.focusInIndex;\n        }\n        return this._currentIndex - this.offset;\n    }\n    set currentIndex(currentIndex) {\n        this._currentIndex = currentIndex + this.offset;\n    }\n    get direction() {\n        return this._direction();\n    }\n    get elements() {\n        if (!this.cachedElements) {\n            this.cachedElements = this._elements();\n        }\n        return this.cachedElements;\n    }\n    set focused(focused) {\n        if (focused === this.focused)\n            return;\n        this._focused = focused;\n    }\n    get focused() {\n        return this._focused;\n    }\n    get focusInElement() {\n        return this.elements[this.focusInIndex];\n    }\n    get focusInIndex() {\n        return this._focusInIndex(this.elements);\n    }\n    isEventWithinListenerScope(event) {\n        if (this._listenerScope() === this.host)\n            return true;\n        return event.composedPath().includes(this._listenerScope());\n    }\n    update({ elements } = { elements: () => [] }) {\n        this.unmanage();\n        this._elements = elements;\n        this.clearElementCache();\n        this.manage();\n    }\n    focus(options) {\n        let focusElement = this.elements[this.currentIndex];\n        if (!focusElement || !this.isFocusableElement(focusElement)) {\n            this.setCurrentIndexCircularly(1);\n            focusElement = this.elements[this.currentIndex];\n        }\n        if (focusElement && this.isFocusableElement(focusElement)) {\n            focusElement.focus(options);\n        }\n    }\n    clearElementCache(offset = 0) {\n        delete this.cachedElements;\n        this.offset = offset;\n    }\n    setCurrentIndexCircularly(diff) {\n        const { length } = this.elements;\n        let steps = length;\n        // start at a possibly not 0 index\n        let nextIndex = (length + this.currentIndex + diff) % length;\n        while (\n        // don't cycle the elements more than once\n        steps &&\n            this.elements[nextIndex] &&\n            !this.isFocusableElement(this.elements[nextIndex])) {\n            nextIndex = (length + nextIndex + diff) % length;\n            steps -= 1;\n        }\n        this.currentIndex = nextIndex;\n    }\n    hostContainsFocus() {\n        this.host.addEventListener('focusout', this.handleFocusout);\n        this.host.addEventListener('keydown', this.handleKeydown);\n        this.focused = true;\n    }\n    hostNoLongerContainsFocus() {\n        this.host.addEventListener('focusin', this.handleFocusin);\n        this.host.removeEventListener('focusout', this.handleFocusout);\n        this.host.removeEventListener('keydown', this.handleKeydown);\n        this.currentIndex = this.focusInIndex;\n        this.focused = false;\n    }\n    isRelatedTargetAnElement(event) {\n        const relatedTarget = event.relatedTarget;\n        return !this.elements.includes(relatedTarget);\n    }\n    acceptsEventCode(code) {\n        if (code === 'End' || code === 'Home') {\n            return true;\n        }\n        switch (this.direction) {\n            case 'horizontal':\n                return code === 'ArrowLeft' || code === 'ArrowRight';\n            case 'vertical':\n                return code === 'ArrowUp' || code === 'ArrowDown';\n            case 'both':\n            case 'grid':\n                return code.startsWith('Arrow');\n        }\n    }\n    manage() {\n        this.addEventListeners();\n    }\n    unmanage() {\n        this.removeEventListeners();\n    }\n    addEventListeners() {\n        this.host.addEventListener('focusin', this.handleFocusin);\n    }\n    removeEventListeners() {\n        this.host.removeEventListener('focusin', this.handleFocusin);\n        this.host.removeEventListener('focusout', this.handleFocusout);\n        this.host.removeEventListener('keydown', this.handleKeydown);\n    }\n    hostConnected() {\n        this.addEventListeners();\n    }\n    hostDisconnected() {\n        this.removeEventListeners();\n    }\n}\n//# sourceMappingURL=FocusGroup.js.map","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { FocusGroupController } from './FocusGroup.js';\nexport class RovingTabindexController extends FocusGroupController {\n    constructor() {\n        super(...arguments);\n        this.managed = true;\n        this.manageIndexesAnimationFrame = 0;\n    }\n    set focused(focused) {\n        if (focused === this.focused)\n            return;\n        super.focused = focused;\n        this.manageTabindexes();\n    }\n    get focused() {\n        return super.focused;\n    }\n    clearElementCache(offset = 0) {\n        cancelAnimationFrame(this.manageIndexesAnimationFrame);\n        super.clearElementCache(offset);\n        if (!this.managed)\n            return;\n        this.manageIndexesAnimationFrame = requestAnimationFrame(() => this.manageTabindexes());\n    }\n    manageTabindexes() {\n        if (this.focused) {\n            this.updateTabindexes(() => ({ tabIndex: -1 }));\n        }\n        else {\n            this.updateTabindexes((el) => {\n                return {\n                    removeTabIndex: el.contains(this.focusInElement) &&\n                        el !== this.focusInElement,\n                    tabIndex: el === this.focusInElement ? 0 : -1,\n                };\n            });\n        }\n    }\n    updateTabindexes(getTabIndex) {\n        this.elements.forEach((el) => {\n            const { tabIndex, removeTabIndex } = getTabIndex(el);\n            if (!removeTabIndex) {\n                el.tabIndex = tabIndex;\n                return;\n            }\n            el.removeAttribute('tabindex');\n            const updatable = el;\n            if (updatable.requestUpdate)\n                updatable.requestUpdate();\n        });\n    }\n    manage() {\n        this.managed = true;\n        this.manageTabindexes();\n        super.manage();\n    }\n    unmanage() {\n        this.managed = false;\n        this.updateTabindexes(() => ({ tabIndex: 0 }));\n        super.unmanage();\n    }\n    hostUpdated() {\n        if (!this.host.hasUpdated) {\n            this.manageTabindexes();\n        }\n    }\n}\n//# sourceMappingURL=RovingTabindex.js.map"],"names":["constructor","host","direction","elementEnterAction","elements","focusInIndex","isFocusableElement","listenerScope","this","_el","_elements","event","isEventWithinListenerScope","isRelatedTargetAnElement","hostContainsFocus","composedPath","path","find","el","targetIndex","indexOf","currentIndex","hostNoLongerContainsFocus","acceptsEventCode","code","defaultPrevented","diff","directionLength","length","preventDefault","setCurrentIndexCircularly","focus","addController","_direction","_focusInIndex","_listenerScope","_currentIndex","offset","cachedElements","focused","_focused","focusInElement","includes","update","unmanage","clearElementCache","manage","options","focusElement","steps","nextIndex","addEventListener","handleFocusout","handleKeydown","handleFocusin","removeEventListener","relatedTarget","startsWith","addEventListeners","removeEventListeners","hostConnected","hostDisconnected","super","manageTabindexes","cancelAnimationFrame","manageIndexesAnimationFrame","managed","requestAnimationFrame","updateTabindexes","tabIndex","removeTabIndex","contains","getTabIndex","forEach","removeAttribute","updatable","requestUpdate","hostUpdated","hasUpdated"],"mappings":"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"}
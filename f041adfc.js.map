{"version":3,"file":"f041adfc.js","sources":["../../../tools/reactive-controllers/src/FocusGroup.js","../../../tools/reactive-controllers/src/RovingTabindex.js"],"sourcesContent":["\"use strict\";import{MutationController as l}from\"@lit-labs/observers/mutation-controller.js\";function r(i,e,t){return typeof i===e?()=>i:typeof i==\"function\"?i:t}export class FocusGroupController{constructor(e,{direction:t,elementEnterAction:n,elements:s,focusInIndex:o,isFocusableElement:h,listenerScope:c}={elements:()=>[]}){this._currentIndex=-1;this._direction=()=>\"both\";this.directionLength=5;this.elementEnterAction=e=>{};this._focused=!1;this._focusInIndex=e=>0;this.isFocusableElement=e=>!0;this._listenerScope=()=>this.host;this.offset=0;this.handleFocusin=e=>{if(!this.isEventWithinListenerScope(e))return;this.isRelatedTargetAnElement(e)&&this.hostContainsFocus();const t=e.composedPath();let n=-1;t.find(s=>(n=this.elements.indexOf(s),n!==-1)),this.currentIndex=n>-1?n:this.currentIndex};this.handleFocusout=e=>{this.isRelatedTargetAnElement(e)&&this.hostNoLongerContainsFocus()};this.handleKeydown=e=>{if(!this.acceptsEventCode(e.code)||e.defaultPrevented)return;let t=0;switch(e.code){case\"ArrowRight\":t+=1;break;case\"ArrowDown\":t+=this.direction===\"grid\"?this.directionLength:1;break;case\"ArrowLeft\":t-=1;break;case\"ArrowUp\":t-=this.direction===\"grid\"?this.directionLength:1;break;case\"End\":this.currentIndex=0,t-=1;break;case\"Home\":this.currentIndex=this.elements.length-1,t+=1;break}e.preventDefault(),this.direction===\"grid\"&&this.currentIndex+t<0?this.currentIndex=0:this.direction===\"grid\"&&this.currentIndex+t>this.elements.length-1?this.currentIndex=this.elements.length-1:this.setCurrentIndexCircularly(t),this.elementEnterAction(this.elements[this.currentIndex]),this.focus()};new l(e,{config:{childList:!0,subtree:!0},callback:()=>{this.handleItemMutation()}}),this.host=e,this.host.addController(this),this._elements=s,this.isFocusableElement=h||this.isFocusableElement,this._direction=r(t,\"string\",this._direction),this.elementEnterAction=n||this.elementEnterAction,this._focusInIndex=r(o,\"number\",this._focusInIndex),this._listenerScope=r(c,\"object\",this._listenerScope)}get currentIndex(){return this._currentIndex===-1&&(this._currentIndex=this.focusInIndex),this._currentIndex-this.offset}set currentIndex(e){this._currentIndex=e+this.offset}get direction(){return this._direction()}get elements(){return this.cachedElements||(this.cachedElements=this._elements()),this.cachedElements}set focused(e){e!==this.focused&&(this._focused=e)}get focused(){return this._focused}get focusInElement(){return this.elements[this.focusInIndex]}get focusInIndex(){return this._focusInIndex(this.elements)}isEventWithinListenerScope(e){return this._listenerScope()===this.host?!0:e.composedPath().includes(this._listenerScope())}handleItemMutation(){if(this._currentIndex==-1||this.elements.length<=this._elements().length)return;const e=this.elements[this.currentIndex];if(this.clearElementCache(),this.elements.includes(e))return;const t=this.currentIndex!==this.elements.length,n=t?1:-1;t&&this.setCurrentIndexCircularly(-1),this.setCurrentIndexCircularly(n),this.focus()}update({elements:e}={elements:()=>[]}){this.unmanage(),this._elements=e,this.clearElementCache(),this.manage()}focus(e){const t=this.elements;if(!t.length)return;let n=t[this.currentIndex];(!n||!this.isFocusableElement(n))&&(this.setCurrentIndexCircularly(1),n=t[this.currentIndex]),n&&this.isFocusableElement(n)&&n.focus(e)}clearElementCache(e=0){delete this.cachedElements,this.offset=e}setCurrentIndexCircularly(e){const{length:t}=this.elements;let n=t,s=(t+this.currentIndex+e)%t;for(;n&&this.elements[s]&&!this.isFocusableElement(this.elements[s]);)s=(t+s+e)%t,n-=1;this.currentIndex=s}hostContainsFocus(){this.host.addEventListener(\"focusout\",this.handleFocusout),this.host.addEventListener(\"keydown\",this.handleKeydown),this.focused=!0}hostNoLongerContainsFocus(){this.host.addEventListener(\"focusin\",this.handleFocusin),this.host.removeEventListener(\"focusout\",this.handleFocusout),this.host.removeEventListener(\"keydown\",this.handleKeydown),this.focused=!1}isRelatedTargetAnElement(e){const t=e.relatedTarget;return!this.elements.includes(t)}acceptsEventCode(e){if(e===\"End\"||e===\"Home\")return!0;switch(this.direction){case\"horizontal\":return e===\"ArrowLeft\"||e===\"ArrowRight\";case\"vertical\":return e===\"ArrowUp\"||e===\"ArrowDown\";case\"both\":case\"grid\":return e.startsWith(\"Arrow\")}}manage(){this.addEventListeners()}unmanage(){this.removeEventListeners()}addEventListeners(){this.host.addEventListener(\"focusin\",this.handleFocusin)}removeEventListeners(){this.host.removeEventListener(\"focusin\",this.handleFocusin),this.host.removeEventListener(\"focusout\",this.handleFocusout),this.host.removeEventListener(\"keydown\",this.handleKeydown)}hostConnected(){this.addEventListeners()}hostDisconnected(){this.removeEventListeners()}}\n//# sourceMappingURL=FocusGroup.js.map\n","\"use strict\";import{FocusGroupController as s}from\"./FocusGroup.js\";export class RovingTabindexController extends s{constructor(){super(...arguments);this.managed=!0;this.manageIndexesAnimationFrame=0}set focused(e){e!==this.focused&&(super.focused=e,this.manageTabindexes())}get focused(){return super.focused}clearElementCache(e=0){cancelAnimationFrame(this.manageIndexesAnimationFrame),super.clearElementCache(e),this.managed&&(this.manageIndexesAnimationFrame=requestAnimationFrame(()=>this.manageTabindexes()))}manageTabindexes(){this.focused?this.updateTabindexes(()=>({tabIndex:-1})):this.updateTabindexes(e=>({removeTabIndex:e.contains(this.focusInElement)&&e!==this.focusInElement,tabIndex:e===this.focusInElement?0:-1}))}updateTabindexes(e){this.elements.forEach(a=>{const{tabIndex:t,removeTabIndex:i}=e(a);if(!i){a.tabIndex=t;return}a.removeAttribute(\"tabindex\");const n=a;n.requestUpdate&&n.requestUpdate()})}manage(){this.managed=!0,this.manageTabindexes(),super.manage()}unmanage(){this.managed=!1,this.updateTabindexes(()=>({tabIndex:0})),super.unmanage()}hostUpdated(){this.host.hasUpdated||this.manageTabindexes()}}\n//# sourceMappingURL=RovingTabindex.js.map\n"],"names":["r","value","type","fallback","FocusGroupController","constructor","host","direction","elementEnterAction","elements","focusInIndex","isFocusableElement","listenerScope","this","_currentIndex","_direction","directionLength","_el","_focused","_focusInIndex","_elements","_listenerScope","offset","event","isEventWithinListenerScope","isRelatedTargetAnElement","hostContainsFocus","composedPath","targetIndex","path","find","el","indexOf","currentIndex","handleFocusout","hostNoLongerContainsFocus","handleKeydown","acceptsEventCode","code","defaultPrevented","diff","length","preventDefault","setCurrentIndexCircularly","focus","MutationController","config","childList","subtree","callback","handleItemMutation","addController","ensureMethod","cachedElements","focused","focusInElement","includes","e","clearElementCache","focusedElement","moveToNextElement","update","unmanage","manage","options","focusElement","t","nextIndex","steps","addEventListener","handleFocusin","removeEventListener","relatedTarget","startsWith","addEventListeners","removeEventListeners","hostConnected","hostDisconnected","RovingTabindexController","s","super","arguments","managed","manageIndexesAnimationFrame","manageTabindexes","cancelAnimationFrame","requestAnimationFrame","updateTabindexes","tabIndex","removeTabIndex","contains","getTabIndex","forEach","i","removeAttribute","updatable","requestUpdate","hostUpdated","hasUpdated"],"mappings":"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"}
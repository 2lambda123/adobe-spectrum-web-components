let i,t;async function s(){return t||async function(){i=window.EventTarget;try{new i}catch{i=(await import("./ed07bf1d.js")).EventTarget}return t=i}()}function e(i){return"horizontal"===i?"width":"height"}function o(i){return"horizontal"===i?"height":"width"}class h{constructor(i){this._latestCoords={left:0,top:0},this._direction=null,this._viewportSize={width:0,height:0},this.totalScrollSize={width:0,height:0},this.offsetWithinScroller={left:0,top:0},this._pendingReflow=!1,this._pendingLayoutUpdate=!1,this._pin=null,this._firstVisible=0,this._lastVisible=0,this._eventTargetPromise=s().then((i=>{this._eventTarget=new i})),this._physicalMin=0,this._physicalMax=0,this._first=-1,this._last=-1,this._sizeDim="height",this._secondarySizeDim="width",this._positionDim="top",this._secondaryPositionDim="left",this._scrollPosition=0,this._scrollError=0,this._items=[],this._scrollSize=1,this._overhang=1e3,this._eventTarget=null,Promise.resolve().then((()=>this.config=i||this._defaultConfig))}get _defaultConfig(){return{direction:"vertical"}}set config(i){Object.assign(this,Object.assign({},this._defaultConfig,i))}get config(){return{direction:this.direction}}get items(){return this._items}set items(i){i!==this._items&&(this._items=i,this._scheduleReflow())}get direction(){return this._direction}set direction(i){(i="horizontal"===i?i:"vertical")!==this._direction&&(this._direction=i,this._sizeDim="horizontal"===i?"width":"height",this._secondarySizeDim="horizontal"===i?"height":"width",this._positionDim="horizontal"===i?"left":"top",this._secondaryPositionDim="horizontal"===i?"top":"left",this._triggerReflow())}get viewportSize(){return this._viewportSize}set viewportSize(i){const{_viewDim1:t,_viewDim2:s}=this;Object.assign(this._viewportSize,i),s!==this._viewDim2?this._scheduleLayoutUpdate():t!==this._viewDim1&&this._checkThresholds()}get viewportScroll(){return this._latestCoords}set viewportScroll(i){Object.assign(this._latestCoords,i);const t=this._scrollPosition;this._scrollPosition=this._latestCoords[this._positionDim];Math.abs(t-this._scrollPosition)>=1&&this._updateVisibleIndices({emit:!0}),this._checkThresholds()}reflowIfNeeded(i=!1){(i||this._pendingReflow)&&(this._pendingReflow=!1,this._reflow())}set pin(i){this._pin=i,this._triggerReflow()}get pin(){if(null!==this._pin){const{index:i,block:t}=this._pin;return{index:Math.max(0,Math.min(i,this.items.length-1)),block:t}}return null}_clampScrollPosition(i){return Math.max(-this.offsetWithinScroller[this._positionDim],Math.min(i,this.totalScrollSize[e(this.direction)]-this._viewDim1))}unpin(){null!==this._pin&&(this._emitUnpinned(),this._pin=null)}async dispatchEvent(i){await this._eventTargetPromise,this._eventTarget.dispatchEvent(i)}async addEventListener(i,t,s){await this._eventTargetPromise,this._eventTarget.addEventListener(i,t,s)}async removeEventListener(i,t,s){await this._eventTargetPromise,this._eventTarget.removeEventListener(i,t,s)}_updateLayout(){}get _viewDim1(){return this._viewportSize[this._sizeDim]}get _viewDim2(){return this._viewportSize[this._secondarySizeDim]}_scheduleReflow(){this._pendingReflow=!0}_scheduleLayoutUpdate(){this._pendingLayoutUpdate=!0,this._scheduleReflow()}_triggerReflow(){this._scheduleLayoutUpdate(),Promise.resolve().then((()=>this.reflowIfNeeded()))}_reflow(){this._pendingLayoutUpdate&&(this._updateLayout(),this._pendingLayoutUpdate=!1),this._updateScrollSize(),this._setPositionFromPin(),this._getActiveItems(),this._updateVisibleIndices(),this._emitScrollSize(),this._emitRange(),this._emitChildPositions(),this._emitScrollError()}_setPositionFromPin(){if(null!==this.pin){const i=this._scrollPosition,{index:t,block:s}=this.pin;this._scrollPosition=this._calculateScrollIntoViewPosition({index:t,block:s||"start"})-this.offsetWithinScroller[this._positionDim],this._scrollError=i-this._scrollPosition}}_calculateScrollIntoViewPosition(i){const{block:t}=i,s=Math.min(this.items.length,Math.max(0,i.index)),e=this._getItemPosition(s)[this._positionDim];let o=e;if("start"!==t){const i=this._getItemSize(s)[this._sizeDim];if("center"===t)o=e-.5*this._viewDim1+.5*i;else{const s=e-this._viewDim1+i;if("end"===t)o=s;else{const i=this._scrollPosition;o=Math.abs(i-e)<Math.abs(i-s)?e:s}}}return o+=this.offsetWithinScroller[this._positionDim],this._clampScrollPosition(o)}getScrollIntoViewCoordinates(i){return{[this._positionDim]:this._calculateScrollIntoViewPosition(i)}}_emitUnpinned(){this.dispatchEvent(new CustomEvent("unpinned"))}_emitRange(){const i={first:this._first,last:this._last,firstVisible:this._firstVisible,lastVisible:this._lastVisible};this.dispatchEvent(new CustomEvent("rangechange",{detail:i}))}_emitScrollSize(){const i={[this._sizeDim]:this._scrollSize,[this._secondarySizeDim]:null};this.dispatchEvent(new CustomEvent("scrollsizechange",{detail:i}))}_emitScrollError(){if(this._scrollError){const i={[this._positionDim]:this._scrollError,[this._secondaryPositionDim]:0};this.dispatchEvent(new CustomEvent("scrollerrorchange",{detail:i})),this._scrollError=0}}_emitChildPositions(){if(-1!==this._first&&-1!==this._last){const i=new Map;for(let t=this._first;t<=this._last;t++)i.set(t,this._getItemPosition(t));this.dispatchEvent(new CustomEvent("itempositionchange",{detail:i}))}}get _num(){return-1===this._first||-1===this._last?0:this._last-this._first+1}_checkThresholds(){if(0===this._viewDim1&&this._num>0||null!==this._pin)this._scheduleReflow();else{const i=Math.max(0,this._scrollPosition-this._overhang),t=Math.min(this._scrollSize,this._scrollPosition+this._viewDim1+this._overhang);(this._physicalMin>i||this._physicalMax<t)&&this._scheduleReflow()}}_updateVisibleIndices(i){if(-1===this._first||-1===this._last)return;let t=this._first;for(;t<this._last&&Math.round(this._getItemPosition(t)[this._positionDim]+this._getItemSize(t)[this._sizeDim])<=Math.round(this._scrollPosition);)t++;let s=this._last;for(;s>this._first&&Math.round(this._getItemPosition(s)[this._positionDim])>=Math.round(this._scrollPosition+this._viewDim1);)s--;t===this._firstVisible&&s===this._lastVisible||(this._firstVisible=t,this._lastVisible=s,i&&i.emit&&this._emitRange())}}export{h as B,o as a,e as d};
//# sourceMappingURL=ca64915d.js.map

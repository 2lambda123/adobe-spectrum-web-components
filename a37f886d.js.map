{"version":3,"file":"a37f886d.js","sources":["../../../tools/reactive-controllers/src/FocusGroup.js","../../../tools/reactive-controllers/src/RovingTabindex.js"],"sourcesContent":["\"use strict\";function r(i,e,t){return typeof i===e?()=>i:typeof i==\"function\"?i:t}export class FocusGroupController{constructor(e,{direction:t,elementEnterAction:n,elements:s,focusInIndex:o,isFocusableElement:h,listenerScope:c}={elements:()=>[]}){this._currentIndex=-1;this._direction=()=>\"both\";this.directionLength=5;this.elementEnterAction=e=>{};this._focused=!1;this._focusInIndex=e=>0;this.isFocusableElement=e=>!0;this._listenerScope=()=>this.host;this.offset=0;this.recentlyConnected=!1;this.handleFocusin=e=>{if(!this.isEventWithinListenerScope(e))return;this.isRelatedTargetAnElement(e)&&this.hostContainsFocus();const t=e.composedPath();let n=-1;t.find(s=>(n=this.elements.indexOf(s),n!==-1)),this.currentIndex=n>-1?n:this.currentIndex};this.handleFocusout=e=>{this.isRelatedTargetAnElement(e)&&this.hostNoLongerContainsFocus()};this.handleKeydown=e=>{if(!this.acceptsEventCode(e.code)||e.defaultPrevented)return;let t=0;switch(e.code){case\"ArrowRight\":t+=1;break;case\"ArrowDown\":t+=this.direction===\"grid\"?this.directionLength:1;break;case\"ArrowLeft\":t-=1;break;case\"ArrowUp\":t-=this.direction===\"grid\"?this.directionLength:1;break;case\"End\":this.currentIndex=0,t-=1;break;case\"Home\":this.currentIndex=this.elements.length-1,t+=1;break}e.preventDefault(),this.direction===\"grid\"&&this.currentIndex+t<0?this.currentIndex=0:this.direction===\"grid\"&&this.currentIndex+t>this.elements.length-1?this.currentIndex=this.elements.length-1:this.setCurrentIndexCircularly(t),this.elementEnterAction(this.elements[this.currentIndex]),this.focus()};this.mutationObserver=new MutationObserver(()=>{this.handleItemMutation()}),this.host=e,this.host.addController(this),this._elements=s,this.isFocusableElement=h||this.isFocusableElement,this._direction=r(t,\"string\",this._direction),this.elementEnterAction=n||this.elementEnterAction,this._focusInIndex=r(o,\"number\",this._focusInIndex),this._listenerScope=r(c,\"object\",this._listenerScope)}get currentIndex(){return this._currentIndex===-1&&(this._currentIndex=this.focusInIndex),this._currentIndex-this.offset}set currentIndex(e){this._currentIndex=e+this.offset}get direction(){return this._direction()}get elements(){return this.cachedElements||(this.cachedElements=this._elements()),this.cachedElements}set focused(e){e!==this.focused&&(this._focused=e)}get focused(){return this._focused}get focusInElement(){return this.elements[this.focusInIndex]}get focusInIndex(){return this._focusInIndex(this.elements)}isEventWithinListenerScope(e){return this._listenerScope()===this.host?!0:e.composedPath().includes(this._listenerScope())}handleItemMutation(){if(this._currentIndex==-1||this.elements.length<=this._elements().length)return;const e=this.elements[this.currentIndex];if(this.clearElementCache(),this.elements.includes(e))return;const t=this.currentIndex!==this.elements.length,n=t?1:-1;t&&this.setCurrentIndexCircularly(-1),this.setCurrentIndexCircularly(n),this.focus()}update({elements:e}={elements:()=>[]}){this.unmanage(),this._elements=e,this.clearElementCache(),this.manage()}focus(e){const t=this.elements;if(!t.length)return;let n=t[this.currentIndex];(!n||!this.isFocusableElement(n))&&(this.setCurrentIndexCircularly(1),n=t[this.currentIndex]),n&&this.isFocusableElement(n)&&n.focus(e)}clearElementCache(e=0){this.mutationObserver.disconnect(),delete this.cachedElements,this.offset=e,requestAnimationFrame(()=>{this.elements.forEach(t=>{this.mutationObserver.observe(t,{attributes:!0})})})}setCurrentIndexCircularly(e){const{length:t}=this.elements;let n=t,s=(t+this.currentIndex+e)%t;for(;n&&this.elements[s]&&!this.isFocusableElement(this.elements[s]);)s=(t+s+e)%t,n-=1;this.currentIndex=s}hostContainsFocus(){this.host.addEventListener(\"focusout\",this.handleFocusout),this.host.addEventListener(\"keydown\",this.handleKeydown),this.focused=!0}hostNoLongerContainsFocus(){this.host.addEventListener(\"focusin\",this.handleFocusin),this.host.removeEventListener(\"focusout\",this.handleFocusout),this.host.removeEventListener(\"keydown\",this.handleKeydown),this.focused=!1}isRelatedTargetAnElement(e){const t=e.relatedTarget;return!this.elements.includes(t)}acceptsEventCode(e){if(e===\"End\"||e===\"Home\")return!0;switch(this.direction){case\"horizontal\":return e===\"ArrowLeft\"||e===\"ArrowRight\";case\"vertical\":return e===\"ArrowUp\"||e===\"ArrowDown\";case\"both\":case\"grid\":return e.startsWith(\"Arrow\")}}manage(){this.addEventListeners()}unmanage(){this.removeEventListeners()}addEventListeners(){this.host.addEventListener(\"focusin\",this.handleFocusin)}removeEventListeners(){this.host.removeEventListener(\"focusin\",this.handleFocusin),this.host.removeEventListener(\"focusout\",this.handleFocusout),this.host.removeEventListener(\"keydown\",this.handleKeydown)}hostConnected(){this.recentlyConnected=!0,this.addEventListeners()}hostDisconnected(){this.mutationObserver.disconnect(),this.removeEventListeners()}hostUpdated(){this.recentlyConnected&&(this.recentlyConnected=!1,this.elements.forEach(e=>{this.mutationObserver.observe(e,{attributes:!0})}))}}\n//# sourceMappingURL=FocusGroup.js.map\n","\"use strict\";import{FocusGroupController as i}from\"./FocusGroup.js\";export class RovingTabindexController extends i{constructor(){super(...arguments);this.managed=!0;this.manageIndexesAnimationFrame=0}set focused(e){e!==this.focused&&(super.focused=e,this.manageTabindexes())}get focused(){return super.focused}clearElementCache(e=0){cancelAnimationFrame(this.manageIndexesAnimationFrame),super.clearElementCache(e),this.managed&&(this.manageIndexesAnimationFrame=requestAnimationFrame(()=>this.manageTabindexes()))}manageTabindexes(){this.focused?this.updateTabindexes(()=>({tabIndex:-1})):this.updateTabindexes(e=>({removeTabIndex:e.contains(this.focusInElement)&&e!==this.focusInElement,tabIndex:e===this.focusInElement?0:-1}))}updateTabindexes(e){this.elements.forEach(a=>{const{tabIndex:t,removeTabIndex:s}=e(a);if(!s){a.tabIndex=t;return}a.removeAttribute(\"tabindex\");const n=a;n.requestUpdate&&n.requestUpdate()})}manage(){this.managed=!0,this.manageTabindexes(),super.manage()}unmanage(){this.managed=!1,this.updateTabindexes(()=>({tabIndex:0})),super.unmanage()}hostUpdated(){super.hostUpdated(),this.host.hasUpdated||this.manageTabindexes()}}\n//# sourceMappingURL=RovingTabindex.js.map\n"],"names":["r","value","type","fallback","constructor","host","direction","elementEnterAction","elements","focusInIndex","isFocusableElement","listenerScope","this","_currentIndex","_direction","directionLength","_el","_focused","_focusInIndex","_elements","_listenerScope","offset","recentlyConnected","handleFocusin","event","isEventWithinListenerScope","isRelatedTargetAnElement","hostContainsFocus","path","composedPath","targetIndex","find","el","indexOf","currentIndex","handleFocusout","hostNoLongerContainsFocus","acceptsEventCode","code","defaultPrevented","diff","length","preventDefault","setCurrentIndexCircularly","focus","mutationObserver","MutationObserver","handleItemMutation","addController","ensureMethod","cachedElements","focused","focusInElement","includes","e","clearElementCache","focusedElement","t","moveToNextElement","update","unmanage","manage","options","focusElement","disconnect","requestAnimationFrame","forEach","element","observe","attributes","nextIndex","steps","addEventListener","handleKeydown","removeEventListener","relatedTarget","startsWith","addEventListeners","removeEventListeners","hostConnected","hostDisconnected","hostUpdated","RovingTabindexController","i","super","arguments","managed","manageIndexesAnimationFrame","manageTabindexes","cancelAnimationFrame","updateTabindexes","tabIndex","removeTabIndex","contains","getTabIndex","s","removeAttribute","updatable","requestUpdate","hasUpdated"],"mappings":"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"}
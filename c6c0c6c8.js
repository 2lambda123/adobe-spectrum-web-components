import{s as t,y as e,e as i,Z as s}from"./95f60e39.js";import{d as n,e as o,b as r,v as a,s as h}from"./3c677636.js";import{B as d,d as l,a as p}from"./a85561c2.js";import{i as c,S as g}from"./d230bd74.js";import{R as u}from"./464e15ff.js";import"./f4a2163c.js";import"./b6459f98.js";function m(t,e,i,s){var n,o=arguments.length,r=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(o<3?n(r):o>3?n(e,i,r):n(e,i))||r);return o>3&&r&&Object.defineProperty(e,i,r),r}class _ extends t{constructor(){super(...arguments),this.items=[],this.renderItem=n,this.keyFunction=o,this.layout={},this.scroller=!1}createRenderRoot(){return this}render(){const{items:t,renderItem:i,keyFunction:s,layout:n,scroller:o}=this;return e`${r({items:t,renderItem:i,keyFunction:s,layout:n,scroller:o})}`}element(t){var e;return null===(e=this[a])||void 0===e?void 0:e.element(t)}get layoutComplete(){var t;return null===(t=this[a])||void 0===t?void 0:t.layoutComplete}scrollToIndex(t,e="start"){var i;null===(i=this.element(t))||void 0===i||i.scrollIntoView({block:e})}}function f(t){return"horizontal"===t?"row":"column"}m([i({attribute:!1})],_.prototype,"items",void 0),m([i()],_.prototype,"renderItem",void 0),m([i()],_.prototype,"keyFunction",void 0),m([i({attribute:!1})],_.prototype,"layout",void 0),m([i({reflect:!0,type:Boolean})],_.prototype,"scroller",void 0);class y extends d{constructor(){super(...arguments),this._itemSize={},this._gaps={},this._padding={}}get _defaultConfig(){return Object.assign({},super._defaultConfig,{itemSize:{width:"300px",height:"300px"},gap:"8px",padding:"match-gap"})}get _gap(){return this._gaps.row}get _idealSize(){return this._itemSize[l(this.direction)]}get _idealSize1(){return this._itemSize[l(this.direction)]}get _idealSize2(){return this._itemSize[p(this.direction)]}get _gap1(){return this._gaps[(t=this.direction,"horizontal"===t?"column":"row")];var t}get _gap2(){return this._gaps[f(this.direction)]}get _padding1(){const t=this._padding,[e,i]="horizontal"===this.direction?["left","right"]:["top","bottom"];return[t[e],t[i]]}get _padding2(){const t=this._padding,[e,i]="horizontal"===this.direction?["top","bottom"]:["left","right"];return[t[e],t[i]]}set itemSize(t){const e=this._itemSize;"string"==typeof t&&(t={width:t,height:t});const i=parseInt(t.width),s=parseInt(t.height);i!==e.width&&(e.width=i,this._triggerReflow()),s!==e.height&&(e.height=s,this._triggerReflow())}set gap(t){const e=t.split(" ").map((t=>function(t){return"auto"===t?1/0:parseInt(t)}(t))),i=this._gaps;e[0]!==i.row&&(i.row=e[0],this._triggerReflow()),void 0===e[1]?e[0]!==i.column&&(i.column=e[0],this._triggerReflow()):e[1]!==i.column&&(i.column=e[1],this._triggerReflow())}set padding(t){const e=this._padding,i=t.split(" ").map((t=>function(t){return"match-gap"===t?1/0:parseInt(t)}(t)));1===i.length?e.top=e.right=e.bottom=e.left=i[0]:2===i.length?(e.top=e.bottom=i[0],e.right=e.left=i[1]):3===i.length?(e.top=i[0],e.right=e.left=i[1],e.bottom=i[2]):4===i.length&&["top","right","bottom","left"].forEach(((t,s)=>e[t]=i[s]))}}class S extends y{constructor(){super(...arguments),this._metrics=null,this.flex=null,this.justify=null}get _defaultConfig(){return Object.assign({},super._defaultConfig,{flex:!1,justify:"start"})}set gap(t){super.gap=t}_updateLayout(){const t=this.justify,[e,i]=this._padding1,[s,n]=this._padding2;["_gap1","_gap2"].forEach((e=>{const i=this[e];if(i===1/0&&!["space-between","space-around","space-evenly"].includes(t))throw new Error("grid layout: gap can only be set to 'auto' when justify is set to 'space-between', 'space-around' or 'space-evenly'");if(i===1/0&&"_gap2"===e)throw new Error(`grid layout: ${f(this.direction)}-gap cannot be set to 'auto' when direction is set to ${this.direction}`)}));const o=this.flex||["start","center","end"].includes(t),r={rolumns:-1,itemSize1:-1,itemSize2:-1,gap1:this._gap1===1/0?-1:this._gap1,gap2:o?this._gap2:0,padding1:{start:e===1/0?this._gap1:e,end:i===1/0?this._gap1:i},padding2:o?{start:s===1/0?this._gap2:s,end:n===1/0?this._gap2:n}:{start:0,end:0},positions:[]},a=this._viewDim2-r.padding2.start-r.padding2.end;if(a<=0)r.rolumns=0;else{const s=o?r.gap2:0;let n,h=0,d=0;if(a>=this._idealSize2&&(h=Math.floor((a-this._idealSize2)/(this._idealSize2+s))+1,d=h*this._idealSize2+(h-1)*s),this.flex){(a-d)/(this._idealSize2+s)>=.5&&(h+=1),r.rolumns=h,r.itemSize2=Math.round((a-s*(h-1))/h);switch(!0===this.flex?"area":this.flex.preserve){case"aspect-ratio":r.itemSize1=Math.round(this._idealSize1/this._idealSize2*r.itemSize2);break;case l(this.direction):r.itemSize1=Math.round(this._idealSize1);break;default:r.itemSize1=Math.round(this._idealSize1*this._idealSize2/r.itemSize2)}}else r.itemSize1=this._idealSize1,r.itemSize2=this._idealSize2,r.rolumns=h;if(o){const e=r.rolumns*r.itemSize2+(r.rolumns-1)*r.gap2;n=this.flex||"start"===t?r.padding2.start:"end"===t?this._viewDim2-r.padding2.end-e:Math.round(this._viewDim2/2-e/2)}else{const s=a-r.rolumns*r.itemSize2;"space-between"===t?(r.gap2=Math.round(s/(r.rolumns-1)),n=0):"space-around"===t?(r.gap2=Math.round(s/r.rolumns),n=Math.round(r.gap2/2)):(r.gap2=Math.round(s/(r.rolumns+1)),n=r.gap2),this._gap1===1/0&&(r.gap1=r.gap2,e===1/0&&(r.padding1.start=n),i===1/0&&(r.padding1.end=n))}for(let t=0;t<r.rolumns;t++)r.positions.push(n),n+=r.itemSize2+r.gap2}this._metrics=r}}class z extends S{get _delta(){return this._metrics.itemSize1+this._metrics.gap1}_getItemSize(t){return{[this._sizeDim]:this._metrics.itemSize1,[this._secondarySizeDim]:this._metrics.itemSize2}}_getActiveItems(){const t=this._metrics,{rolumns:e}=t;if(0===e)this._first=-1,this._last=-1,this._physicalMin=0,this._physicalMax=0;else{const{padding1:i}=t,s=Math.max(0,this._scrollPosition-this._overhang),n=Math.min(this._scrollSize,this._scrollPosition+this._viewDim1+this._overhang),o=Math.max(0,Math.floor((s-i.start)/this._delta)),r=Math.max(0,Math.ceil((n-i.start)/this._delta));this._first=o*e,this._last=Math.min(r*e-1,this.items.length-1),this._physicalMin=i.start+this._delta*o,this._physicalMax=i.start+this._delta*r}}_getItemPosition(t){const{rolumns:e,padding1:i,positions:s,itemSize1:n,itemSize2:o}=this._metrics;return{[this._positionDim]:i.start+Math.floor(t/e)*this._delta,[this._secondaryPositionDim]:s[t%e],[l(this.direction)]:n,[p(this.direction)]:o}}_updateScrollSize(){const{rolumns:t,gap1:e,padding1:i,itemSize1:s}=this._metrics;let n=1;if(t>0){const o=Math.ceil(this.items.length/t);n=i.start+o*s+(o-1)*e+i.end}this._scrollSize=n}}var v=c`
:host{contain:strict;display:block;pointer-events:none;position:relative}::slotted(*){pointer-events:all}
`;class b{constructor(t,{elements:e,itemSize:i,gap:s,padding:n}){this._first=0,this._last=0,this.handleFocusin=t=>{const e=t=>{requestAnimationFrame((()=>{requestAnimationFrame((()=>{t()}))}))},i=()=>this.host.scrollToIndex(0),s=()=>{this.focus(),this.host.tabIndex=-1};t.target===this.host&&(this._first>0?e((()=>{i(),e(s)})):e(s))},this.handleFocusout=t=>{(!t.relatedTarget||!this.host.contains(t.relatedTarget))&&(this.host.tabIndex=0)},this.handleRangeChanged=t=>{this.rovingTabindexController.clearElementCache(t.first)},this.handleVisibleChanged=t=>{this._first=t.first,this._last=t.last},this.host=t,this.host.addController(this),this.applyLayout(i,s,n),this.resizeController=new h(this.host,{callback:t=>{t.forEach((t=>{this.measureDirectionLength(t.contentRect)}))}}),this.rovingTabindexController=new u(this.host,{direction:"grid",elements:e,focusInIndex:()=>this.host.getRootNode().activeElement===this.host?0:-1})}get itemSize(){return this._itemSize()}_itemSize(){return{width:100,height:100}}get gap(){return this._gap()}_gap(){}get padding(){return this._padding()}_padding(){}focus(t){this.rovingTabindexController.focus(t)}applyLayout(t,e,i){"object"==typeof t?this._itemSize=()=>t:"function"==typeof t&&void 0!==t()&&(this._itemSize=t),"string"==typeof e?this._gap=()=>e:"function"==typeof e&&(this._gap=e),"string"==typeof i?this._padding=()=>i:"function"==typeof i&&(this._padding=i)}update({elements:t,itemSize:e,gap:i,padding:s}){this.rovingTabindexController.update({elements:t}),this.applyLayout(e,i,s);const n=this.host.getBoundingClientRect();this.measureDirectionLength(n)}measureDirectionLength(t){const e=this.gap?parseFloat(this.gap):0,i=this.padding?parseFloat(this.padding):0,s=t.width-2*i,n=Math.floor((s-this.itemSize.width)/(e+this.itemSize.width))+1;this.rovingTabindexController.directionLength=Math.floor(n)}hostConnected(){this.host.addEventListener("rangeChanged",this.handleRangeChanged),this.host.addEventListener("visibilityChanged",this.handleVisibleChanged),this.host.addEventListener("focusin",this.handleFocusin),this.host.addEventListener("focusout",this.handleFocusout),this.host.tabIndex=0,this.host.style.setProperty("outline","none","important")}hostDisconnected(){this.host.removeEventListener("rangeChanged",this.handleRangeChanged),this.host.removeEventListener("visibilityChanged",this.handleVisibleChanged),this.host.removeEventListener("focusin",this.handleFocusin),this.host.removeEventListener("focusout",this.handleFocusout)}}var w=Object.defineProperty,C=Object.getOwnPropertyDescriptor,x=(t,e,i,s)=>{for(var n,o=s>1?void 0:s?C(e,i):e,r=t.length-1;r>=0;r--)(n=t[r])&&(o=(s?n(e,i,o):n(o))||o);return s&&o&&w(e,i,o),o};class M extends _{constructor(){super(...arguments),this.gap="0",this.items=[],this.itemSize={width:200,height:200},this.selected=[],this.gridController=new b(this,{elements:()=>[],itemSize:()=>this.itemSize,gap:()=>this.gap,padding:()=>this.padding||this.gap})}static get styles(){return[v]}handleChange(t){const e=t.target,i=this.items[parseFloat(e.getAttribute("key")||"")],s=[...this.selected];if(s.includes(i)){const t=s.indexOf(i);t>-1&&s.splice(t,1)}else s.push(i);this.selected=s}createRenderRoot(){var t;const e=null!=(t=this.shadowRoot)?t:this.attachShadow(this.constructor.shadowRootOptions);return g(e,this.constructor.elementStyles),e}render(){return e`
            <slot></slot>
        `}update(t){if((t.has("itemSize")||t.has("gap")||t.has("padding")||t.has("focusableSelector"))&&(this.updateComplete.then((()=>{this.gridController.update({elements:()=>[...this.querySelectorAll(this.focusableSelector)],itemSize:()=>this.itemSize,gap:()=>this.gap,padding:()=>this.padding||this.gap})})),this.layout=(e={itemSize:{width:`${this.itemSize.width}px`,height:`${this.itemSize.height}px`},gap:this.gap,padding:this.padding||this.gap},Object.assign({type:z},e))),t.has("renderItem")){const t=this.renderItem;this.renderItem=(e,i)=>{const s=this.selected.includes(e);return t(e,i,s)}}var e;this.isConnected&&s(super.render(),this),super.update(t)}connectedCallback(){super.connectedCallback(),this.addEventListener("change",this.handleChange,{capture:!0})}disconnectedCallback(){this.removeEventListener("change",this.handleChange,{capture:!0}),super.disconnectedCallback()}}x([i({type:String})],M.prototype,"focusableSelector",2),x([i({type:String})],M.prototype,"gap",2),x([i({type:String})],M.prototype,"padding",2),x([i({type:Array})],M.prototype,"items",2),x([i({type:Object})],M.prototype,"itemSize",2),x([i({type:Array})],M.prototype,"selected",2),customElements.define("sp-grid",M);
//# sourceMappingURL=c6c0c6c8.js.map
